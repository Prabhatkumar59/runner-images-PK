name: Test Ninja with CMake on Windows 2022

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-2022

    steps:
      - name: Add Ninja to PATH
        shell: pwsh
        run: |
          echo "C:\Program Files\Ninja" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

      - name: Check Ninja version
        run: ninja --version
        shell: pwsh

      - name: Create C++ project and CMake config
        shell: pwsh
        run: |
          New-Item -ItemType Directory -Path test-project
          
          @'
int main() {
    return 0;
}
'@ | Set-Content -Path test-project\main.cpp -Encoding utf8

          @'
cmake_minimum_required(VERSION 3.10)
project(TestNinja)
add_executable(testapp main.cpp)
'@ | Set-Content -Path test-project\CMakeLists.txt -Encoding utf8

      - name: Configure using CMake + Ninja
        shell: pwsh
        run: |
          cd test-project
          cmake -G "Ninja" .

      - name: Build using Ninja
        shell: pwsh
        run: |
          cd test-project
          ninja
